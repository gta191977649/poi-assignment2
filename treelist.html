<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- 2 load the theme CSS file -->
    <link rel="stylesheet" href="js/themes/default/style.css" />

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">

</head>

<body>
    <h1 style="color:mediumslateblue;" >Ajax View</h1>
  
    <!-- 3 setup a container element -->
    <div id="tree-list">
        <!-- in this example the tree is populated from inline HTML -->
        <!--
        <ul>
            <li>Root node 1
                <ul>
                    <li id="child_node_1">Child node 1</li>
                    <li>Child node 2</li>
                </ul>
            </li>
            <li>Root node 2</li>
        </ul>
        -->
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script> 
   
    <script>
        function generateCatList(divID) {
            //获取categories.xml 
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET", "xml/categories.xml", false);
            xmlhttp.send();
            var catXML = xmlhttp.responseXML;


            //获取要生成HTML的div对象
            var listDiv = document.getElementById(divID);
            //读取全部分类
            var catXMLNodes = catXML.getElementsByTagName("Categories");

            //获取products.xml
            var xmlhttp2 = new XMLHttpRequest();
            xmlhttp2.open("GET", "xml/products.xml", false);
            xmlhttp2.send();
            var productXML = xmlhttp2.responseXML;

            //读取全部产品
            var productXMLNodes = productXML.getElementsByTagName("Products");


            var listULElement = listDiv.appendChild(document.createElement("ol"));
            listULElement.setAttribute("type","i");
            for (var i = 0; i < catXMLNodes.length; i++) {
                var cat = catXMLNodes[i];
                //该分类的名称
                var catName = cat.getElementsByTagName("CategoryName")[0].childNodes[0].nodeValue;
                //该分类的ID
                var catID = cat.getElementsByTagName("CategoryID")[0].childNodes[0].nodeValue;
                //console.log(cat.getElementsByTagName("CategoryID")[0].childNodes[0].nodeValue);
                //listDiv.innerHTML = "<li>" + catName + "</li>";
                //生成<li></li>标签
                var listLIElement = listULElement.appendChild(document.createElement("li"));

                
                //套入文字到li标签里面
                var textLIElement = listLIElement.appendChild(document.createTextNode(catName));

                /*
                var ULInSecondList = listLIElement.appendChild(document.createElement("ul"));
                ULInSecondList.appendChild(document.createTextNode("sss"));
                */

                
                var ULInSecondList = listLIElement.appendChild(document.createElement("ol"));
                ULInSecondList.setAttribute("type","a");
                //找出该分类中的全部产品
                for (var j = 0; j < productXMLNodes.length; j++) {

                    var product = productXMLNodes[j];
                    //获取products.xml里面的每个产品的ID
                    var productID = product.getElementsByTagName("ProductID")[0].childNodes[0].nodeValue;
                    var productCatID = product.getElementsByTagName("CategoryID")[0].childNodes[0].nodeValue;
                    //获取产品的名称
                    var productName = product.getElementsByTagName("ProductName")[0].childNodes[0].nodeValue;
                    
                    //判断如果有找到该分类的产品,添加到子节点
                    if (parseInt(productCatID) == parseInt(catID)) {
                        //在最开始创建一个ul标签
                        
                        var LIINSecoundList = ULInSecondList.appendChild(document.createElement("li"));
                        //att.value = productID;
                        LIINSecoundList.appendChild(document.createTextNode(productName));
                    }
                }
            }

        }
        generateCatList("tree-list");

    </script>


    <!-- 
        Ref
            Used JS Library:
                Jstree.com. (n.d.). jstree. [online] Available at: https://www.jstree.com/ [Accessed 8 May 2018]
            Used UI FrameWork:
                Mark Otto, a. (n.d.). Bootstrap. [online] Getbootstrap.com. Available at: https://getbootstrap.com/ [Accessed 8 May 2018].
    -->
</body>

</html>